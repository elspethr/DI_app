<!doctype html>
<html lang="en">

<head>

<meta charset="utf-8">

<style type="text/css">
body{color:black; font-size:16px; font-family:"Helvetica Neue", Helvetica, sans-serif; background:#FFFFFF; margin:0px; text-align:center}
body.center{margin-left=auto; margin-right=auto}
div{text-align:left; background:#FFFFFF; margin:0 auto}
div.padded{width:930px; padding-top:20px; padding-right:20px;
padding-bottom:20px; padding-left:20px; text-align:left}
div.tabs{font-size:14px; font-style:bold; background:#583759;text-align:center}
a{text-decoration: none}
svg{margin-left:5; margin-right:auto; display:block;}
</style>

<link href="static/nv.d3.css" rel="stylesheet">
<script src="static/d3.v3.js"></script>
<script src="static/nv.d3.js"></script>
<script src="static/jquery-3.0.0.min.js"></script>

<title>Park info</title>

</head>

<body>

<div class=padded>
{{div|safe}}
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="925px" height="271" background="static/rollercoaster_small.jpg" valign="bottom" align="right">
</td>
</tr>
</table>
  
<h2>{{code}} summary</h2>

<!--Current weather conditions: {{temp}} &#8457;, wind {{wind}} miles per hour.-->
 
<h3>Crowd levels for next 36 hours<br></h3>

<div id="chart">
<svg style="height:400px;width:875px"> </svg>
</div>
<script type="text/javascript">

var chart;
var chart_data;

nv.addGraph(function() {
  chart = nv.models.lineChart()
                .margin({left: 100})
                .useInteractiveGuideline(true) ;

  chart.xAxis     
      .axisLabel('Time (PST)')
      .tickFormat(function(d) {
          return d3.time.format('%H:%M')(new Date(1000*d))
          });

  chart.yAxis 
      .axisLabel('Crowd prediction (tweets per acre)')
      .tickFormat(d3.format('.02f'));

  chart_data=d3.select('#chart svg').datum([]);
  chart_data.transition().duration(500).call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});

function parse_data(result){
  var estimates=[];
  var averages=[];

  for(var i=0; i<result.length; i++) {
      estimates.push({"x":result[i]["x"], "y":result[i]["y"]});
      averages.push({"x":result[i]["x"], "y":result[i]["y2"]});
}

  var packed_data = [{"key":"Model estimate", "values":result, "color": '#ff7f0e'},
                     {"key":"Average hourly level", "values":averages, "color":'#7777ff'}];

  chart_data.datum(packed_data).transition().duration(500).call(chart);
};

//**************************************

$.getJSON("/query?option={{code}}",function(result){

parse_data(result);
//console.log(result, estimates, averages);

});

</script>


<h3>Crowd levels for next 10 days</h3>

<div id="chart2">
<svg style="height:400px;width:875px"> </svg>
</div>
<script type="text/javascript">
var chart2;
var chart_data2;

nv.addGraph(function() {
  chart2 = nv.models.lineChart()
                .margin({left: 100})
                .useInteractiveGuideline(true) ;

  chart2.xAxis     
      .axisLabel('Date')
      .tickFormat(function(d) {
          return d3.time.format('%b %d')(new Date(1000*d))
          });

  chart2.yAxis 
      .axisLabel('Crowd prediction (tweets per acre)')
      .tickFormat(d3.format('.02f'));

  chart_data2=d3.select('#chart2 svg').datum([]);
  chart_data2.transition().duration(500).call(chart2);

  nv.utils.windowResize(chart2.update);

  return chart2;
});

//**************************************

$.getJSON("/dailyquery?option={{code}}",function(dailyresult){

var dailyestimates=[];
var dailyaverages=[];

for(var i=0; i<dailyresult.length; i++) {
  dailyestimates.push({"x":dailyresult[i]["x"], "y":dailyresult[i]["y"]});
  dailyaverages.push({"x":dailyresult[i]["x"], "y":dailyresult[i]["y2"]});
}

packed_data2 = [{"key":"Model estimate", "values":dailyestimates, "color": '#ff7f0e'},
        {"key":"Average daily level", "values":dailyaverages, "color": '#7777ff'}];

//console.log(dailyresult, estimates, averages)

chart_data2.datum(packed_data2).transition().duration(500).call(chart2);

});

</script>


<b>Learn more about the <a href="/info">technical details</a> of this project.</b><br><br>

<a href="/index"><b>Back to main page</b></a>

</div>

</body>
</html>